<!DOCTYPE html>
<html lang="en">
<head>
    <!-- 核心文件 -->
    <link href="../bootstrap3/css/bootstrap.css" rel="stylesheet" type="text/css">
    <script src="../bootstrap3/jquery-1.9.1.min.js"></script>

    <!--  sweetAlert2 -->
    <link rel="stylesheet" type="text/css" href="../../css/com.sweetAlert2/sweetAlert2.css"/>


    <!-- 自訂CSS -->
    <link rel="stylesheet" type="text/css" href="../../css/com/nav/shopLogo.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/index.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/backStage/indexTable.css"/>

    <meta charset="UTF-8">
    <title>後台</title>

    <style>
        .nav > li > a:hover, .nav > li > a:focus {
            text-decoration: none;
            background-color: #bce8f1;
        }

        /*========================================================*/
        /*       預覽圖框框*/
        #previewImg {
            max-width: 200px; /* 最大宽度，根据需要调整 */
            max-height: 200px; /* 最大高度，根据需要调整 */
            object-fit: contain; /* 保持图片的比例 */
            border: 1px solid #ccc; /* 可选，为图片添加边框 */
            padding: 5px; /* 可选，为图片添加内边距 */
            background-color: #f9f9f9; /* 可选，为图片添加背景色 */
        }

        /*========================================================*/
        input{
            text-align: center;
        }
    </style>

</head>
<body>

<header class="header">
    <!-- 商城文字 logo -->
    <div class="row" id="logo-position"></div>
</header>

<!-- 導航 -->
<div class="row top-nav" id="nav-container">
    <h1 id="TabName"></h1>
    <!-- Tab 切換 -->
    <ul class="nav nav-pills" id="nav-ul">
        <!--        <li class="activePage"><a class="nav-li-a" href="#home">回到首頁 <span class="fa fa-home"></span></a></li>-->
        <li><a class="nav-li-a" href="#member">會員管理<span class="fa fa-users"></span></a></li>
        <li><a class="nav-li-a" href="#orders">訂單管理<span class="fa fa-list-alt"></span></a></li>
        <li><a class="nav-li-a" href="#product">商品管理<span class="fa fa-tags"></span></a></li>
        <li><a class="nav-li-a" href="#newProduct">新增商品<span class="fa fa-tags"></span></a></li>


        <!--        <li><a class="nav-li-a" href="#cart">購物車管理<span class="fa fa-shopping-cart"></span></a></li>-->
        <!--        <li><a class="nav-li-a" href="#regions">行政區劃管理<span class="fa fa-map-marker"></span></a></li>-->
        <!-- 搜索表单 -->
        <form action="search.html" class="form-inline pull-right" role="form" id="search-form">
            <div class="form-group">
                <input type="text" class="form-control" id="search" name="search" placeholder="請輸入商品名稱">
            </div>
            <button type="submit" class="btn btn-default btn-sm"><span class="fa fa-search"></span></button>
        </form>
    </ul>
    <!-- 内容 -->

    <!--    <div class="content-panel activePage" id="Backhome">回到首頁</div>-->
    <div class="content-panel" id="member">會員管理...</div>
    <div class="content-panel" id="orders">訂單管理...</div>
    <div class="content-panel" id="product">商品管理...</div>
    <!-- 新增商品tab -->
    <div id="newProduct" class="content-panel">

        <form id="addProductForm">
            <table>
                <tr>
                    <td>商品區分:</td>
                    <td>
                        <select name="categoryId">
                            <option value="1">生活用品</option>
                            <option value="2">盥洗用品</option>
                            <option value="3">家具</option>

                        </select>
                    </td>
                </tr>

                <tr>
                    <td>商品種類:</td>
                    <td>
                        <select name="itemType">
                            <option value="筆記本">筆記本</option>
                            <option value="筆記型電腦">筆記型電腦</option>
                            <option value="鍋具">鍋具</option>
                            <option value="杯子">杯子</option>
                            <option value="衣櫃">衣櫃</option>

                        </select>
                    </td>
                </tr>

                <tr>
                    <td>商品標題:</td>
                    <td><input name="title" type="text"></td>
                </tr>

                <tr>
                    <td>商品促銷標題:</td>
                    <td><input name="sellPoint" type="text"></td>
                </tr>

                <tr>
                    <td>商品單價:</td>
                    <td><input name="price" type="number"></td>
                </tr>

                <tr>
                    <td>庫存:</td>
                    <td><input name="num" type="number"></td>
                </tr>

                <tr>
                    <td>商品圖片:</td>
                    <td>
                        <input id="productImg" name="image" type="file">
                        <img id="previewImg" src="">
                    </td>
                </tr>

                <tr>
                    <td>商品狀態:</td>
                    <td>
                        <select name="status">
                            <option value="0">下架</option>
                            <option value="1">上架</option>
                        </select>
                    </td>
                </tr>

                <tr>
                    <td>商品優先級:(1~10)</td>
                    <td>
                        <input name="priority"  id="priority" type="range" min="1" max="10">
                        <span id="priority-value"></span>
                    </td>
                </tr>

                <tr>
                    <td colspan="2">
                        <button type="submit">保存</button>
                    </td>
                </tr>
            </table>
        </form>

    </div>
    <!--        <div class="content-panel" id="cart">購物車管理...</div>-->
    <!--        <div class="content-panel" id="regions">行政區劃管理...</div>-->
    <div id="page-content-div">
        <!--        <div id="content"></div>-->
        <!--        <div id="pagination"></div>-->
        <div id="prev-next-buttons">
            <button id="prev-button">上一頁</button>
            <div id="current-page">1</div>
            <button id="next-button">下一頁</button>
        </div>
    </div>

</div>

<script src="../../js/com/nav/showLogoDiv.js"></script>
<script src="../../js/com/nav/showHotList.js"></script>
<!--Data-->
<script src="../../js/backStage/getUserData.js"></script>
<script src="../../js/backStage/getOrderData.js"></script>
<script src="../../js/backStage/getProductData.js"></script>
<script src="../../js/backStage/ProductPage.js"></script>
<!--sweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.2/dist/sweetalert2.all.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.2/dist/sweetalert2.min.css" rel="stylesheet">

<script type="text/javascript">
    $(document).ready(function () {
        showLogoDiv();
        showHotList();
        // Data
        getUserData();
        getOrderData();
        getProductData();
        // ProductPage();

        // 主頁分頁切換
        $('.nav-li-a').on('click', function (e) {
            e.preventDefault();
            let targetPanel = $(this).attr('href').substring(1);
            $('.content-panel').removeClass('activePage');
            $('#' + targetPanel).addClass('activePage');
            $('.nav-pills li').removeClass('activePage');
            $(this).parent('li').addClass('activePage');

            const TabName = document.querySelector("#TabName");
            let CurActivePage = document.querySelector(".activePage");

            TabName.innerText = CurActivePage.innerText;
            if (targetPanel === 'product') {
                $('#page-content-div').css('display', 'block');
            } else {
                $('#page-content-div').css('display', 'none');
            }
        });
    });


    //==========================================================================
    //優先級 滑動 JS
    $('input[name="priority"]').change(function () {
        let priority = $(this).val();
    });

    let input = $('input[name="priority"]');

    input.change(function () {
        $('#priority-value').text($(this).val());
    });
    // const range = document.getElementById("priority");
    // const priority_value = document.getElementById(("priority-value");
    //
    // range.addEventListener("change" ,()=>{
    //     priority_value.innerText = range.innerText;
    // });

    //圖片預覽
    //==========================================================================
    // 圖片上傳
    $('#productImg').change(function () {

        // 拿到選中的東西
        let file = this.files[0];

        // 使用FileReader讀取文件
        let reader = new FileReader();

        // 读取成功完成后
        reader.onload = function () {
            // 设置预览图片的src为读取的DataURL
            $('#previewImg').attr('src', reader.result);
        };

        // 读取文件内容
        reader.readAsDataURL(file);

    });


    $('#addProductForm').submit(function(e) {
        e.preventDefault(); // 防止表单自动提交

        let formData = new FormData(this); // 使用FormData对象包含文件数据

        $.ajax({
            url: '/product/add',
            type: 'POST',
            data: formData,
            contentType: false, // 不设置内容类型
            processData: false, // 不处理数据
            success: function(json) {
                if(json.state === 200){
                    alert("產品新增成功");
                    // window.location = `http://localhost:8081/BackStage#product`;
                    location.reload();
                }
                // 请求成功处理
            },
            error: function(xhr) {
                // 请求失败处理
                alert("產品新增失敗: " + xhr.message);
            }
        });
    });


</script>
</body>
</html>
